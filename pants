#!/bin/bash
# Copyright 2015 Foursquare Labs Inc. All Rights Reserved.

set -e

if [[ -z "$SKIP_UPKEEP" ]]; then
  ./upkeep
fi

# Copied to root by upkeep.
source environ.sh

# This is being left in as a backstop but needs to be removed prior to open sourcing.
if [ "$(uname)" == "Darwin" ]; then
  export JDK_HOME=$(/usr/libexec/java_home -v 1.8.0_40)
else
  if [ ! -f /data/loko/infrastructure-jdk8/current/bin/java ]; then
    echo "Pants must have the infrastructure-jdk8 loko package installed in order"
    echo " to run on linux."
    exit 1
  fi
fi

# Points to the pants.ini to use for pants config.
export PANTS_CONFIG_OVERRRIDE="$PANTS_CONFIG_OVERRIDE"

if [ -z "$PANTSBINARY" ]; then
  exec .pantsenv/bin/pants --print-exception-stacktrace "$@"
else
  export PYTHONPATH=src/python
  exec $PANTSBINARY --print-exception-stacktrace "$@"
fi
