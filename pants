#! /usr/bin/env python

# pants


import inspect
import os.path
import sys

# Add <root>/src/python to the import path so we can use standard Foursquare modules.
root_dir = os.path.dirname(inspect.getfile(inspect.currentframe()))
def path(*p): return os.path.join(root_dir, *p)
python_dir = path("src", "python")
sys.path.insert(0, python_dir)

from foursquare.common.process import check_output
from foursquare.toolchain.pants import run_and_log_pants, get_current_binary

import os
import sys

def pick_pants_cmd(build_root_dir):
    args = []
    pants_binary = None
    for arg in sys.argv[1:]:
        if arg.startswith("--pants-binary="):
           pants_binary = arg.split("=", 1)[1]
        elif arg.startswith("--pants-version="):
           pants_binary = build_root_dir + "/build-support/pants-%s.pex" % arg.split("=", 1)[1]
        elif arg == '--beta':
           pants_binary = build_root_dir + "/build-support/pants-beta.pex"
        else:
            args.append(arg)  # Pass through to pants.pex.

    if pants_binary is None:
        pants_binary = get_current_binary(build_root_dir)

    return [pants_binary, "goal"] + args

def main():
    build_root_dir = os.path.dirname(__file__)
    cmd = pick_pants_cmd(build_root_dir)
    os.putenv("PYTHONPATH", build_root_dir + u"/src/python")
    exit(run_and_log_pants(cmd))
if __name__ == '__main__':
  main()
